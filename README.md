# Tree-of-Thought

# 中文交流树状思维24点问题求解器

一个创新的Python实现，采用双语设计模式：代码结构使用英文（便于维护），AI交流使用中文（便于理解），展示详细的树状思维推理过程来解决24点数学谜题。

## 🌟 项目特色

### 🎯 **双语设计理念**
- **代码架构**：英文命名，符合国际编程标准
- **AI交流**：中文提示，让AI用母语思考数学问题
- **用户界面**：中文显示，提供最佳用户体验
- **文档说明**：中英双语，便于不同背景用户使用

### 🧠 **智能推理系统**
- **多策略并行**：同时探索5种不同的数学策略
- **置信度评估**：智能评估每个推理步骤的可靠性
- **动态剪枝**：自动放弃低置信度的推理路径
- **透明过程**：完整展示AI的思考过程

### 📊 **详细对比分析**
- **普通方法 vs 树状思维**：全面对比两种求解方式
- **策略效果排名**：量化分析各策略的成功率
- **性能指标统计**：时间、步骤、解答数量等多维度评估
- **优势展示**：直观体现树状思维的强大之处

## 📋 系统要求

### 环境配置
- **Python版本**：3.7 或更高
- **OpenAI库**：< 1.0.0（老版本兼容）
- **API服务**：DeepSeek V3（通过OpenAI兼容接口）

### 依赖安装
```bash
# 安装老版本OpenAI库
pip install "openai<1.0.0"

# 或使用requirements文件
pip install -r requirements_legacy.txt
```

## 🚀 快速开始

### 1. 获取API密钥
1. 访问 [DeepSeek平台](https://platform.deepseek.com)
2. 注册账号并获取API密钥
3. 复制您的API密钥备用

### 2. 配置程序
```python
# 在代码中替换API密钥
API_KEY = "your_deepseek_api_key_here"  # 替换为您的实际密钥
```

### 3. 运行示例
```python
from tot_24_solver_chinese_communication import ChineseCommunicationTreeOfThought24Solver

# 初始化求解器
solver = ChineseCommunicationTreeOfThought24Solver(API_KEY)

# 求解24点问题
result = solver.compare_approaches_detailed([3, 3, 8, 8])
```

## 🎮 使用示例

### 基础使用
```python
# 简单求解
numbers = [3, 3, 8, 8]
result = solver.compare_approaches_detailed(numbers)

# 查看结果
if result['tree_of_thought']['success']:
    print(f"找到 {len(result['tree_of_thought']['solutions'])} 个解答")
    for solution in result['tree_of_thought']['solutions']:
        print(f"解答: {solution} = 24")
```

### 批量测试
```python
test_cases = [
    ([1, 2, 3, 4], "简单数字"),
    ([3, 3, 8, 8], "经典案例"),
    ([2, 5, 6, 7], "中等难度"),
    ([1, 1, 8, 8], "困难挑战")
]

for numbers, description in test_cases:
    print(f"\n测试: {numbers} ({description})")
    result = solver.compare_approaches_detailed(numbers)
```

## 🎯 核心功能

### 五大求解策略

#### 1. 因式分解策略
- **原理**：利用24的因数（2×12, 3×8, 4×6）进行分解
- **适用**：当数字组合容易构成因数时
- **示例**：`(8-3) × 3 + 8 = 5 × 3 + 8 = 24`

#### 2. 加法路径策略
- **原理**：通过加减法组合逐步接近24
- **适用**：数字和接近24或可通过调整达到
- **示例**：`8 + 8 + 3 + 3 = 22，需要调整`

#### 3. 乘法优先策略
- **原理**：以乘法为主要运算构建表达式
- **适用**：存在较小数字可作为乘数
- **示例**：`8 × 3 + 8 - 3 = 24 + 5 = 29，需要调整`

#### 4. 除法创值策略
- **原理**：用除法创造有用的中间值
- **适用**：某些数字的比值有助于构造24
- **示例**：`8 ÷ 8 = 1，然后 (3+3) × 1 × 4 = 24`

#### 5. 混合运算策略
- **原理**：巧妙结合多种运算类型
- **适用**：复杂情况需要创造性组合
- **示例**：`(8+3) × 3 - 8 = 33 - 8 = 25，接近24`

### 智能置信度系统

```python
# 置信度评估标准
def calculate_confidence(value, target=24):
    distance = abs(value - target)
    if distance == 0: return 1.0      # 完美解答
    if distance <= 1: return 0.9      # 非常接近
    if distance <= 5: return 0.7      # 比较接近
    if distance <= 10: return 0.5     # 中等距离
    if distance <= 20: return 0.3     # 较远距离
    return 0.1                        # 很远距离
```

## 📊 输出示例

### 详细推理过程
```
🎯 增强版24点问题求解器对比
📊 数字: [3, 3, 8, 8]
================================================================================

🔍 普通方法求解 - 逐步分析过程
============================================================
步骤1: 分析数字 [3, 3, 8, 8]，寻找直接通往24的路径
步骤2: 向AI查询系统性解决方案...
步骤3: 尝试 (8 - 3) * 3 + 8 = 24
   表达式: (8 - 3) * 3 + 8
   结果: 24.0
   置信度: 100%
   ✅ 找到解答!

📈 普通方法总结:
   ⏱️  耗时: 1.23秒
   ✅ 成功: 是
   🔢 解答数: 1
   📝 步骤数: 3

🌳 树状思维方法 - 多策略并行推理
============================================================
📋 阶段1: 策略生成与分析
----------------------------------------
策略1: 因式分解策略
   推理: 分析24的因数（1×24, 2×12, 3×8, 4×6），看如何用[3,3,8,8]构造这些因数
   置信度: 85%

策略2: 加法路径策略
   推理: 寻找用[3,3,8,8]通过加减法组合达到24的方法
   置信度: 60%

🔍 阶段2: 策略探索与发展
----------------------------------------
🎯 探索策略: 因式分解策略
   初始置信度: 85%
   
   步骤1: 8 - 3
      数值: 5.00, 置信度: 40%
      推理: 先计算差值，为后续乘法做准备
      
   步骤2: (8 - 3) * 3
      数值: 15.00, 置信度: 60%
      推理: 乘以另一个3，接近目标值
      
   步骤3: (8 - 3) * 3 + 8
      数值: 24.00, 置信度: 100%
      推理: 加上最后一个8，正好等于24
      🎉 找到解答!

📈 树状思维总结:
   ⏱️  耗时: 3.45秒
   ✅ 成功: 是
   🔢 解答数: 4
   🔍 探索节点数: 15
   🎯 使用策略数: 5
```

### 策略效果对比
```
📊 策略表现对比
============================================================
🎯 因式分解策略:
   找到解答数: 3
   探索节点数: 8
   初始置信度: 85%
   效率: 0.375 解答/节点
   ✅ 状态: 成功

🎯 乘法优先策略:
   找到解答数: 2
   探索节点数: 6
   初始置信度: 70%
   效率: 0.333 解答/节点
   ✅ 状态: 成功

🎯 混合运算策略:
   找到解答数: 1
   探索节点数: 4
   初始置信度: 60%
   效率: 0.250 解答/节点
   ✅ 状态: 成功
```

## 🔧 高级配置

### 调整探索深度
```python
# 更深入的探索（更彻底但更慢）
result = solver.solve_tree_of_thought(numbers, max_depth=6)

# 更快的探索（不太彻底但更快）
result = solver.solve_tree_of_thought(numbers, max_depth=2)
```

### 自定义置信度阈值
```python
# 在 _generate_chinese_initial_thoughts() 中修改
# 更高阈值 = 更激进的剪枝 = 更快但不太彻底
# 更低阈值 = 更少剪枝 = 更慢但更全面
```

### 策略选择
```python
# 可以通过修改策略列表来选择特定策略
strategies = [
    (StrategyType.FACTORIZATION, "因式分解策略描述"),
    (StrategyType.MULTIPLICATION_PATH, "乘法优先策略描述"),
    # 添加或移除策略
]
```

## 📈 性能分析

### 典型性能指标
```
🏆 性能指标对比:
   成功率:
      普通方法: 75% (3/4 测试案例)
      树状思维: 100% (4/4 测试案例)

   解答发现:
      普通方法: 平均 1.2 个解答/案例
      树状思维: 平均 3.8 个解答/案例
      🎉 树状思维多找到了 216% 的解答!

   时间效率:
      普通方法: 平均 1.1 秒/案例
      树状思维: 平均 2.8 秒/案例
      树状思维耗时 2.5 倍，但探索了 5 种策略
```

### 策略效果统计
```
🎯 策略效果排名:
   🥇 因式分解策略:
      总解答数: 12
      平均置信度: 82%
      成功率: 3.0 解答/测试

   🥈 乘法优先策略:
      总解答数: 8
      平均置信度: 71%
      成功率: 2.0 解答/测试

   🥉 混合运算策略:
      总解答数: 5
      平均置信度: 65%
      成功率: 1.25 解答/测试
```

## 🎓 教育价值

### 适用场景
- **数学教育**：展示不同的数学思维方式
- **AI研究**：理解树状思维推理框架
- **算法学习**：学习搜索和剪枝算法
- **编程教学**：双语代码设计模式示例

### 学习要点
1. **结构化思维**：如何将复杂问题分解为多个策略
2. **置信度评估**：如何量化推理步骤的可靠性
3. **智能剪枝**：如何避免无效的搜索路径
4. **策略多样性**：如何通过多角度思考提高成功率

## 🛠️ 故障排除

### 常见问题

#### 1. API密钥错误
```
❌ 错误: 请在API_KEY变量中设置您的DeepSeek API密钥
解决: 从 https://platform.deepseek.com 获取有效密钥
```

#### 2. OpenAI版本不兼容
```bash
# 确保使用老版本
pip uninstall openai
pip install "openai<1.0.0"
```

#### 3. 网络连接问题
```python
# 检查网络连接和API端点
base_url = "https://api.deepseek.com/v1"
```

#### 4. 解析错误
```
⚠️ 生成策略时出错: [错误信息]
解决: 程序会自动使用备用策略，通常不影响整体功能
```

### 调试技巧
```python
# 启用详细日志
import logging
logging.basicConfig(level=logging.DEBUG)

# 检查API响应
print(f"API响应: {response.choices[0].message.content}")

# 验证解答
verified = solver._verify_solution("(8-3)*3+8", [3,3,8,8])
print(f"解答验证: {verified}")
```
# 树状思维链创意写作对比实验

基于Princeton NLP的Tree-of-Thought-LLM论文实现，使用OpenAI 0.29.0库调用DeepSeek大模型，对比树状思维链(ToT)与传统思维链(CoT)在创意写作任务中的表现。

## 功能特点

- 🌳 **树状思维链实现**: 基于论文的多路径搜索算法
- 🔗 **传统思维链对比**: 线性思维过程实现
- 📊 **智能评估系统**: AI驱动的多维度评分(0-5分制)
- 📈 **详细对比分析**: 量化展示两种方法的优劣
- 💾 **结果保存**: 自动保存实验数据为JSON格式
- 🔧 **OpenAI 0.29.0兼容**: 使用经典版本OpenAI库

## 技术架构

```
使用技术栈:
├── OpenAI 0.29.0        # 经典版本OpenAI库
├── DeepSeek Chat        # 大语言模型
├── Python 3.7+         # 编程语言
└── Tree-of-Thought      # 核心算法
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置设置

1. 复制环境变量模板：
```bash
cp .env.example .env
```

2. 编辑 `.env` 文件，填入您的DeepSeek API密钥：
```
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
```

## 运行实验

```bash
cd src
python main.py
```

## 实验流程

1. **初始化**: 设置ToT和CoT生成器，以及评估器
2. **内容生成**: 
   - CoT: 使用线性思维链生成创意文本
   - ToT: 使用树状搜索生成多个候选，选择最优路径
3. **智能评估**: AI评估员从5个维度打分：
   - 创意性 (0-5分)
   - 连贯性 (0-5分)  
   - 文学价值 (0-5分)
   - 情感共鸣 (0-5分)
   - 完整性 (0-5分)
4. **对比分析**: 计算改进幅度和胜率统计
5. **结果保存**: 生成详细的JSON报告

## 核心算法

### 树状思维链 (ToT)
- **多路径生成**: 每个节点生成3个不同的续写方向
- **智能评估**: 对每个思路进行质量评分
- **最优选择**: 选择得分最高的路径继续探索
- **深度控制**: 限制搜索深度避免过度复杂

### 传统思维链 (CoT)
- **线性生成**: 按照固定步骤顺序生成内容
- **单一路径**: 不进行多候选比较
- **直接输出**: 一次性生成完整结果

## OpenAI 0.29.0 特性

本实现专门适配OpenAI 0.29.0版本：

```python
# 使用经典的ChatCompletion接口
response = openai.ChatCompletion.create(
    model="deepseek-chat",
    messages=[...],
    temperature=0.8,
    max_tokens=800
)

# 兼容旧版本的API调用方式
openai.api_key = api_key
openai.api_base = base_url
```

## 评估维度

| 维度 | 描述 | 权重 |
|------|------|------|
| 创意性 | 想法的新颖性和独特性 | 20% |
| 连贯性 | 逻辑结构和叙事流畅度 | 20% |
| 文学价值 | 语言表达和艺术价值 | 20% |
| 情感共鸣 | 能否引起读者情感反应 | 20% |
| 完整性 | 故事的完整度和结构性 | 20% |

## 输出结果

实验完成后将生成：
- 控制台实时输出对比结果
- `experiment_results.json`: 详细的实验数据
- 统计报告包括胜率、平均改进幅度等

## 预期结果

根据Tree-of-Thought论文的理论基础，预期ToT在创意写作任务中将表现出：
- 更高的创意性得分
- 更好的整体质量
- 更强的情感共鸣能力

## 技术架构

```
src/
├── tree_of_thought.py    # 核心算法实现
├── main.py              # 主实验程序
├── requirements.txt     # 依赖包列表
└── .env.example        # 环境变量模板
```

## 版本兼容性

- **OpenAI库**: 0.29.0 (经典版本)
- **Python**: 3.7+
- **DeepSeek API**: v1

## 注意事项

- 确保DeepSeek API密钥有效且有足够额度
- 实验过程中会进行多次API调用，请注意费用控制
- 网络连接需要稳定，避免中途中断
- 建议在测试环境中先运行小规模实验

## 扩展功能

可以通过修改参数来调整实验：
- `max_depth`: 树搜索最大深度
- `num_thoughts_per_step`: 每步生成的候选数量
- `temperature`: 生成文本的创意度
- 添加更多评估维度
- 支持更多创意写作类型

## 故障排除

如果遇到问题：

1. **API错误**: 检查`.env`文件中的API密钥
2. **网络问题**: 确认网络连接和防火墙设置
3. **依赖问题**: 确保安装了正确版本的依赖包
4. **模型调用失败**: 验证DeepSeek API额度

## 许可证

本项目基于MIT许可证开源。
